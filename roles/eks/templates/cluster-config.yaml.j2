apiVersion: eksctl.io/v1alpha5
kind: ClusterConfig

metadata:
  name: {{ eks_cluster_name }}
  region: {{ aws_region }}

vpc:
  id: {{ vpc_id }}
  subnets:
    public:
{% for subnet_id in public_subnet_ids %}
      {{ aws_region }}{{ 'a' if loop.index0 == 0 else 'b' }}:
        id: {{ subnet_id }}
{% endfor %}

iam:
  serviceRoleARN: {{ cluster_role_arn }}

nodeGroups:
  - name: {{ nodegroup_name }}
    instanceType: {{ nodegroup_instance_types[0] }}
    desiredCapacity: {{ nodegroup_desired_size }}
    minSize: {{ nodegroup_min_size }}
    maxSize: {{ nodegroup_max_size }}
    volumeSize: {{ nodegroup_disk_size }}
    iam:
      instanceRoleName: eks-nodegroup-role
    subnets: {{ public_subnet_ids }}
    tags:
      Environment: {{ env_name }}
      ManagedBy: ansible